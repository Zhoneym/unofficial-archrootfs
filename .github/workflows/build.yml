name: Save NVIDIA Docker2 DEBs

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  save-debs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up NVIDIA repository
        run: |
          curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg
          curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
            sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
            sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list

      - name: Update package lists and download NVIDIA Docker2
        run: |
          sudo apt update
          apt download -o=dir::cache=. nvidia-docker2
          apt download -o=dir::cache=. nvidia-container-toolkit
          apt download -o=dir::cache=. nvidia-container-runtime
          apt download -o=dir::cache=. libnvidia-container1 libnvidia-container-tools

      - name: Upload DEB packages
        uses: actions/upload-artifact@v4
        with:
          name: nvidia-docker2-debs
          path: ./*.deb

